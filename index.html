<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>3D图片画廊</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="3D图片展示画廊">

<style>
/* 重置和基础样式 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #000;
    color: #fff;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    position: relative;
}

/* 3D场景容器 */
#scene3d {
    position: absolute;
    width: 100%;
    height: 100%;
    perspective: 1200px;
    transform-style: preserve-3d;
    overflow: hidden;
}

/* 图片容器 */
.pic-container {
    position: absolute;
    width: 200px;
    height: 200px;
    transform-style: preserve-3d;
    transition: transform 0.8s ease-out;
    cursor: pointer;
    border-radius: 8px;
    overflow: visible;
    will-change: transform;
}

/* 图片样式 */
.pic-container .pic-frame {
    width: 100%;
    height: 100%;
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    box-shadow: 
        0 0 0 1px rgba(0, 255, 255, 0.3),
        0 0 20px rgba(0, 255, 255, 0.2),
        0 0 40px rgba(0, 255, 255, 0.1);
    background: rgba(20, 20, 40, 0.9);
    transition: all 0.3s;
}

.pic-container:hover .pic-frame {
    box-shadow: 
        0 0 0 2px rgba(255, 50, 255, 0.6),
        0 0 30px rgba(255, 50, 255, 0.4),
        0 0 60px rgba(255, 50, 255, 0.2);
    transform: scale(1.05);
}

.pic-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.5s;
}

.pic-container:hover img {
    transform: scale(1.1);
}

/* 控制面板 */
.control-panel {
    position: fixed;
    bottom: 20px;
    left: 0;
    width: 100%;
    text-align: center;
    z-index: 1000;
    padding: 15px 0;
    background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
}

.control-btn {
    background: rgba(0, 0, 0, 0.7);
    border: 2px solid #0ff;
    color: #0ff;
    padding: 10px 20px;
    margin: 0 8px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.3s;
    min-width: 100px;
    outline: none;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.control-btn:hover {
    background: rgba(0, 255, 255, 0.2);
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
}

.control-btn.active {
    background: rgba(0, 255, 255, 0.3);
    color: #fff;
    border-color: #fff;
}

/* 信息面板 */
.info-panel {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.8);
    padding: 12px 18px;
    border-radius: 8px;
    border: 1px solid rgba(0, 255, 255, 0.4);
    font-size: 13px;
    z-index: 1000;
    backdrop-filter: blur(5px);
    min-width: 180px;
}

.info-item {
    margin: 5px 0;
    color: #0ff;
    font-weight: 500;
}

.info-item span {
    color: #fff;
    font-weight: normal;
    margin-left: 5px;
}

/* 标题 */
.gallery-title {
    position: fixed;
    top: 20px;
    left: 20px;
    font-size: 24px;
    color: #0ff;
    z-index: 1000;
    text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    font-weight: bold;
    letter-spacing: 2px;
}

/* 加载动画 */
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    transition: opacity 0.5s;
}

.loading-text {
    color: #0ff;
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
    animation: pulse 1.5s infinite;
}

.loading-bar {
    width: 300px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 20px;
}

.loading-progress {
    height: 100%;
    background: #0ff;
    width: 0%;
    transition: width 0.3s;
    box-shadow: 0 0 10px #0ff;
}

@keyframes pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

/* 提示信息 */
.hint-box {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 100, 200, 0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 14px;
    text-align: center;
    min-width: 300px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* 粒子背景 */
.particles-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: #0ff;
    border-radius: 50%;
    animation: float linear infinite;
}

@keyframes float {
    0% { 
        transform: translateY(100vh) translateX(0px) rotate(0deg);
        opacity: 0;
    }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { 
        transform: translateY(-100px) translateX(100px) rotate(360deg);
        opacity: 0;
    }
}

/* 全屏图片查看器 */
.fullscreen-viewer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
    opacity: 0;
    transition: opacity 0.3s;
    backdrop-filter: blur(10px);
}

.fullscreen-img {
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    border-radius: 10px;
    box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
    transform: scale(0.9);
    transition: transform 0.3s;
}

.close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #0ff;
    border-radius: 50%;
    color: #0ff;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

/* 移动端优化 */
@media (max-width: 768px) {
    .pic-container {
        width: 120px;
        height: 120px;
    }
    
    .control-btn {
        padding: 8px 12px;
        font-size: 12px;
        min-width: 70px;
        margin: 2px;
    }
    
    .info-panel {
        padding: 8px 12px;
        font-size: 11px;
        min-width: 150px;
    }
    
    .gallery-title {
        font-size: 18px;
    }
    
    .control-panel {
        padding: 10px 0;
    }
}
</style>
</head>

<body>
<!-- 加载屏幕 -->
<div class="loading-screen" id="loadingScreen">
    <div class="loading-text">正在加载3D画廊...</div>
    <div class="loading-bar">
        <div class="loading-progress" id="loadingProgress"></div>
    </div>
</div>

<!-- 标题 -->
<div class="gallery-title">3D图片画廊</div>

<!-- 信息面板 -->
<div class="info-panel">
    <div class="info-item">图片数量: <span id="picCount">0</span></div>
    <div class="info-item">当前布局: <span id="layoutType">表格</span></div>
    <div class="info-item">FPS: <span id="fpsCounter">60</span></div>
    <div class="info-item">状态: <span id="statusText">就绪</span></div>
</div>

<!-- 3D场景 -->
<div id="scene3d"></div>

<!-- 粒子背景 -->
<div class="particles-bg" id="particlesBg"></div>

<!-- 提示信息 -->
<div class="hint-box" id="hintBox"></div>

<!-- 全屏查看器 -->
<div class="fullscreen-viewer" id="fullscreenViewer">
    <img class="fullscreen-img" id="fullscreenImg" src="" alt="">
    <div class="close-btn" onclick="closeFullscreen()">×</div>
</div>

<!-- 控制面板 -->
<div class="control-panel">
    <button class="control-btn active" onclick="setLayout('table')">表格布局</button>
    <button class="control-btn" onclick="setLayout('sphere')">球形布局</button>
    <button class="control-btn" onclick="setLayout('helix')">螺旋布局</button>
    <button class="control-btn" onclick="setLayout('grid')">网格布局</button>
    <button class="control-btn" onclick="setLayout('random')">随机布局</button>
    <button class="control-btn" onclick="resetView()">重置视图</button>
</div>

<script>
// ========== 全局变量 ==========
let scene = document.getElementById('scene3d');
let pictures = [];
let currentLayout = 'table';
let isDragging = false;
let lastMouseX = 0, lastMouseY = 0;
let rotationX = 0, rotationY = 0;
let targetRotationX = 0, targetRotationY = 0;
let zoom = 1;
let targetZoom = 1;
let autoRotate = true;
let autoRotateSpeed = 0.001;
let lastTime = 0;
let frameCount = 0;
let fps = 0;
let isInitialized = false;

// 图片列表 - 修改为您的图片文件名
const imageFiles = [
    'd1.jpg',
    'd1.jpg',
    'd1.jpg',
    'd1.jpg',
    'd1.jpg',
    'd1.jpg'
];

// 布局配置
const layoutPresets = {
    table: { 
        name: '表格布局',
        rows: 6,
        cols: 6,
        spacing: 280
    },
    sphere: {
        name: '球形布局',
        radius: 1000,
        count: 36
    },
    helix: {
        name: '螺旋布局',
        radius: 800,
        height: 2000,
        turns: 3
    },
    grid: {
        name: '网格布局',
        x: 5,
        y: 5,
        z: 2,
        spacing: 300
    }
};

// ========== 初始化函数 ==========
async function initializeGallery() {
    console.log('开始初始化3D画廊...');
    updateStatus('正在初始化...');
    
    try {
        // 创建粒子背景
        createParticles(40);
        
        // 创建图片容器
        createPictureContainers(36);
        
        // 设置初始布局
        await applyLayout('table');
        
        // 设置事件监听
        setupEventListeners();
        
        // 隐藏加载屏幕
        setTimeout(() => {
            document.getElementById('loadingScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                showHint('3D画廊加载完成！', 2000);
                updateStatus('就绪');
            }, 500);
        }, 1000);
        
        // 开始动画循环
        requestAnimationFrame(animationLoop);
        
        isInitialized = true;
        console.log('3D画廊初始化完成！');
        
    } catch (error) {
        console.error('初始化失败:', error);
        updateStatus('初始化失败');
        showHint('初始化失败: ' + error.message, 5000);
    }
}

// ========== 创建图片容器 ==========
function createPictureContainers(count) {
    for (let i = 0; i < count; i++) {
        const container = document.createElement('div');
        container.className = 'pic-container';
        container.dataset.index = i;
        
        const frame = document.createElement('div');
        frame.className = 'pic-frame';
        
        const img = document.createElement('img');
        const imgIndex = i % imageFiles.length;
        
        // 设置图片源
        img.src = imageFiles[imgIndex];
        img.alt = `图片 ${i + 1}`;
        img.loading = 'lazy';
        
        // 图片加载成功
        img.onload = function() {
            // 更新加载进度
            updateLoadingProgress(i + 1, count);
        };
        
        // 图片加载失败
        img.onerror = function() {
            console.warn(`图片加载失败: ${imageFiles[imgIndex]}`);
            
            // 创建替代内容
            const placeholder = document.createElement('div');
            placeholder.style.cssText = `
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 20px;
                font-weight: bold;
            `;
            placeholder.textContent = i + 1;
            frame.appendChild(placeholder);
            
            // 更新加载进度
            updateLoadingProgress(i + 1, count);
        };
        
        // 点击查看大图
        container.onclick = function(e) {
            e.stopPropagation();
            const imgElement = this.querySelector('img');
            if (imgElement && imgElement.src) {
                showFullscreen(imgElement.src);
            }
        };
        
        frame.appendChild(img);
        container.appendChild(frame);
        scene.appendChild(container);
        pictures.push(container);
    }
    
    document.getElementById('picCount').textContent = count;
    console.log(`创建了 ${count} 个图片容器`);
}

// ========== 创建粒子背景 ==========
function createParticles(count) {
    const container = document.getElementById('particlesBg');
    
    for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // 随机属性
        const size = Math.random() * 3 + 1;
        const x = Math.random() * 100;
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 20;
        const color = Math.random() > 0.7 ? '#f0f' : '#0ff';
        
        particle.style.cssText = `
            width: ${size}px;
            height: ${size}px;
            left: ${x}%;
            opacity: ${Math.random() * 0.6 + 0.2};
            animation-duration: ${duration}s;
            animation-delay: ${delay}s;
            background: ${color};
        `;
        
        container.appendChild(particle);
    }
}

// ========== 布局函数 ==========
function setLayout(layout) {
    if (!isInitialized) return;
    
    if (layout === 'random') {
        const layouts = ['table', 'sphere', 'helix', 'grid'];
        layout = layouts[Math.floor(Math.random() * layouts.length)];
    }
    
    currentLayout = layout;
    
    // 更新按钮状态
    document.querySelectorAll('.control-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // 更新信息显示
    document.getElementById('layoutType').textContent = 
        layout === 'table' ? '表格' :
        layout === 'sphere' ? '球形' :
        layout === 'helix' ? '螺旋' :
        layout === 'grid' ? '网格' : '随机';
    
    // 应用布局
    applyLayout(layout);
    
    showHint(`已切换到${layoutPresets[layout]?.name || layout}`, 1500);
}

async function applyLayout(layout) {
    if (!pictures.length) return;
    
    const config = layoutPresets[layout];
    if (!config) return;
    
    updateStatus(`正在应用${config.name}...`);
    
    return new Promise(resolve => {
        setTimeout(() => {
            pictures.forEach((pic, index) => {
                let x, y, z;
                
                switch(layout) {
                    case 'table':
                        const rows = config.rows;
                        const cols = config.cols;
                        const spacing = config.spacing;
                        const startX = -(cols - 1) * spacing / 2;
                        const startY = -(rows - 1) * spacing / 2;
                        
                        const row = Math.floor(index / cols);
                        const col = index % cols;
                        x = startX + col * spacing;
                        y = startY + row * spacing;
                        z = 0;
                        break;
                        
                    case 'sphere':
                        const phi = Math.acos(-1 + (2 * index) / pictures.length);
                        const theta = Math.sqrt(pictures.length * Math.PI) * phi;
                        x = config.radius * Math.sin(phi) * Math.cos(theta);
                        y = config.radius * Math.cos(phi);
                        z = config.radius * Math.sin(phi) * Math.sin(theta);
                        break;
                        
                    case 'helix':
                        const t = index / pictures.length;
                        const angle = t * Math.PI * 2 * config.turns;
                        x = config.radius * Math.cos(angle);
                        y = (t - 0.5) * config.height;
                        z = config.radius * Math.sin(angle);
                        break;
                        
                    case 'grid':
                        const xCount = config.x;
                        const yCount = config.y;
                        const zCount = config.z;
                        
                        const xi = index % xCount;
                        const yi = Math.floor(index / xCount) % yCount;
                        const zi = Math.floor(index / (xCount * yCount));
                        
                        x = (xi - (xCount - 1) / 2) * config.spacing;
                        y = (yi - (yCount - 1) / 2) * config.spacing;
                        z = (zi - (zCount - 1) / 2) * config.spacing;
                        break;
                        
                    default:
                        x = y = z = 0;
                }
                
                // 应用位置
                pic.style.transform = `translate3d(${x}px, ${y}px, ${z}px)`;
            });
            
            updateStatus('就绪');
            resolve();
        }, 50);
    });
}

// ========== 视图控制 ==========
function resetView() {
    targetRotationX = 0;
    targetRotationY = 0;
    targetZoom = 1;
    rotationX = 0;
    rotationY = 0;
    zoom = 1;
    autoRotate = true;
    
    setLayout('table');
    showHint('视图已重置', 1500);
}

// ========== 全屏查看 ==========
function showFullscreen(src) {
    const viewer = document.getElementById('fullscreenViewer');
    const img = document.getElementById('fullscreenImg');
    
    img.src = src;
    viewer.style.display = 'flex';
    
    setTimeout(() => {
        viewer.style.opacity = '1';
        img.style.transform = 'scale(1)';
    }, 10);
}

function closeFullscreen() {
    const viewer = document.getElementById('fullscreenViewer');
    const img = document.getElementById('fullscreenImg');
    
    viewer.style.opacity = '0';
    img.style.transform = 'scale(0.9)';
    
    setTimeout(() => {
        viewer.style.display = 'none';
        img.src = '';
    }, 300);
}

// ========== 事件监听 ==========
function setupEventListeners() {
    const container = document.getElementById('scene3d');
    
    // 鼠标拖拽旋转
    container.addEventListener('mousedown', (e) => {
        isDragging = true;
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
        autoRotate = false;
    });
    
    document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        
        const deltaX = e.clientX - lastMouseX;
        const deltaY = e.clientY - lastMouseY;
        
        targetRotationY += deltaX * 0.005;
        targetRotationX += deltaY * 0.005;
        
        lastMouseX = e.clientX;
        lastMouseY = e.clientY;
    });
    
    document.addEventListener('mouseup', () => {
        isDragging = false;
        setTimeout(() => { autoRotate = true; }, 3000);
    });
    
    // 滚轮缩放
    container.addEventListener('wheel', (e) => {
        e.preventDefault();
        targetZoom += e.deltaY * -0.001;
        targetZoom = Math.max(0.3, Math.min(3, targetZoom));
    });
    
    // 触摸支持
    container.addEventListener('touchstart', (e) => {
        isDragging = true;
        lastMouseX = e.touches[0].clientX;
        lastMouseY = e.touches[0].clientY;
        autoRotate = false;
    });
    
    container.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        const deltaX = e.touches[0].clientX - lastMouseX;
        const deltaY = e.touches[0].clientY - lastMouseY;
        
        targetRotationY += deltaX * 0.005;
        targetRotationX += deltaY * 0.005;
        
        lastMouseX = e.touches[0].clientX;
        lastMouseY = e.touches[0].clientY;
    });
    
    container.addEventListener('touchend', () => {
        isDragging = false;
        setTimeout(() => { autoRotate = true; }, 3000);
    });
    
    // 键盘快捷键
    document.addEventListener('keydown', (e) => {
        switch(e.key) {
            case ' ':
                e.preventDefault();
                setLayout('random');
                break;
            case 'r':
            case 'R':
                resetView();
                break;
            case '1':
                setLayout('table');
                break;
            case '2':
                setLayout('sphere');
                break;
            case '3':
                setLayout('helix');
                break;
            case '4':
                setLayout('grid');
                break;
            case 'Escape':
                closeFullscreen();
                break;
        }
    });
    
    // ESC键关闭全屏
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            const viewer = document.getElementById('fullscreenViewer');
            if (viewer.style.display === 'flex') {
                closeFullscreen();
            }
        }
    });
}

// ========== 动画循环 ==========
function animationLoop(currentTime) {
    requestAnimationFrame(animationLoop);
    
    // 计算FPS
    frameCount++;
    if (currentTime - lastTime >= 1000) {
        fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
        frameCount = 0;
        lastTime = currentTime;
        document.getElementById('fpsCounter').textContent = fps;
    }
    
    // 平滑插值
    rotationX += (targetRotationX - rotationX) * 0.1;
    rotationY += (targetRotationY - rotationY) * 0.1;
    zoom += (targetZoom - zoom) * 0.1;
    
    // 自动旋转
    if (autoRotate && !isDragging) {
        targetRotationY += autoRotateSpeed;
    }
    
    // 应用变换
    scene.style.transform = `
        rotateX(${rotationX}rad)
        rotateY(${rotationY}rad)
        scale(${zoom})
    `;
}

// ========== 工具函数 ==========
function showHint(text, duration = 2000) {
    const hintBox = document.getElementById('hintBox');
    hintBox.textContent = text;
    hintBox.style.opacity = '1';
    
    setTimeout(() => {
        hintBox.style.opacity = '0';
    }, duration);
}

function updateStatus(text) {
    document.getElementById('statusText').textContent = text;
}

function updateLoadingProgress(current, total) {
    const progress = (current / total) * 100;
    document.getElementById('loadingProgress').style.width = `${progress}%`;
}

// ========== 错误处理 ==========
window.addEventListener('error', function(e) {
    console.error('页面错误:', e.message, 'at', e.filename, ':', e.lineno);
    updateStatus('发生错误');
    showHint('发生错误，请刷新页面', 5000);
});

window.addEventListener('unhandledrejection', function(e) {
    console.error('未处理的Promise拒绝:', e.reason);
});

// ========== 页面加载 ==========
window.addEventListener('DOMContentLoaded', function() {
    console.log('页面加载完成，开始初始化3D画廊...');
    
    // 延迟初始化，确保DOM完全加载
    setTimeout(() => {
        initializeGallery();
    }, 100);
});
</script>
</body>
</html>
